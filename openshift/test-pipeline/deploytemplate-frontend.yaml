kind: Template
apiVersion: v1
metadata:
  name: deploytemplate-frontend
parameters:
  - name: APP_NAME
    required: true
  - name: IMAGE
    required: true
  - name: STAGE
    required: true
  - name: HEALTH_URI
    required: true
    value: /
  - name: WEBCERT_API
    required: true
    value: "webcert-webcert-frontend-2021-2"
objects:
  - apiVersion: v1
    kind: DeploymentConfig
    metadata:
      name: ${APP_NAME}
      generation: 1
      labels:
        app: ${APP_NAME}
        stage: ${STAGE}
    spec:
      replicas: 1
      selector:
        app: ${APP_NAME}
        deploymentconfig: ${APP_NAME}
      template:
        metadata:
          labels:
            app: ${APP_NAME}
            deploymentconfig: ${APP_NAME}
            stage: ${STAGE}
        spec:
          containers:
          - env:
            - name: APP_NAME
              value: ${APP_NAME}
            - name: STAGE
              value: ${STAGE}
            - name: WEBCERT_API
              value: ${WEBCERT_API}
            envFrom:
              - secretRef:
                  name: ${APP_NAME}-secret-envvar
              - configMapRef:
                  name: ${APP_NAME}-configmap-envvar
            image: ${IMAGE}
            imagePullPolicy: Always
            name: ${APP_NAME}
            resources:
              limits:
                cpu: 1
                memory: 2Gi
              requests:
                cpu: 200m
                memory: 1Gi
            ports:
              - containerPort: 8080
                protocol: TCP
            readinessProbe:
              failureThreshold: 3
              httpGet:
                path: ${HEALTH_URI}
                port: 8080
                scheme: HTTP
              initialDelaySeconds: 15
              periodSeconds: 10
              successThreshold: 1
              timeoutSeconds: 2
            livenessProbe:
              failureThreshold: 15
              httpGet:
                path: ${HEALTH_URI}
                port: 8080
                scheme: HTTP
              initialDelaySeconds: 60
              periodSeconds: 20
              successThreshold: 1
              timeoutSeconds: 5
            terminationMessagePath: /dev/termination-log
            terminationMessagePolicy: File
          dnsPolicy: ClusterFirst
          restartPolicy: Always
          schedulerName: default-scheduler
          securityContext: {}
          terminationGracePeriodSeconds: 30
  - apiVersion: v1
    kind: Service
    metadata:
      labels:
        app: ${APP_NAME}
      name: ${APP_NAME}
    spec:
      ports:
      - name: 8080-tcp
        port: 8080
        protocol: TCP
        targetPort: 8080
      selector:
        deploymentconfig: ${APP_NAME}
      sessionAffinity: None
      type: ClusterIP


