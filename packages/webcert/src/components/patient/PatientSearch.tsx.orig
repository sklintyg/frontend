<<<<<<< HEAD
import React, { useEffect, useState } from 'react'
import { CustomButton } from '@frontend/common'
import { isPersonIdValid } from '@frontend/common/src/utils/personIdValidatorUtils'
import styled from 'styled-components/macro'
=======
import React, { ChangeEvent, useCallback, useEffect, useState } from 'react'
import { CustomButton, TextInput } from '@frontend/common'
import { isPatientIdValid } from './patientIdValidatorUtils'
import InvalidPatientIdMessage from './InvalidPatientIdMessage'
import styled, { css } from 'styled-components/macro'
>>>>>>> b9317b4 (WIP Redirect search and create page and add handling of initial state loading)
import { useDispatch } from 'react-redux'
import { getPatient } from '../../store/patient/patientActions'
import PatientSearchError from './PatientSearchError'
import { useKeyPress } from '@frontend/common/src/utils/userFunctionUtils'
import PersonIdInput from '@frontend/common/src/components/Inputs/PersonIdInput'

const FormWrapper = styled.div`
  display: flex;
  align-items: center;
`

const PatientSearch: React.FC = () => {
  const [patientId, setPatientId] = useState('')
  const dispatch = useDispatch()
  const enterPress = useKeyPress('Enter')

  const onSubmit = useCallback(() => {
    dispatch(getPatient(patientId.replace('-', '')))
  }, [dispatch, patientId])

  useEffect(() => {
    if (enterPress) {
      onSubmit()
    }
  }, [enterPress, onSubmit])

  const onChange = (formattedPatientId: string) => {
    setPatientId(formattedPatientId)
  }

<<<<<<< HEAD
  const onSubmit = () => {
    dispatch(getPatient({ patientId: patientId.replace('-', ''), history: history }))
=======
  const formatPatientId = (patientId: string) => {
    let cleanPatientId = patientId.replace(/\D/g, '')
    if (cleanPatientId.length > 8) {
      cleanPatientId = cleanPatientId.slice(0, 8) + '-' + cleanPatientId.slice(8, cleanPatientId.length)
    }
    return cleanPatientId
>>>>>>> b9317b4 (WIP Redirect search and create page and add handling of initial state loading)
  }

  return (
    <div className="ic-container iu-p-400">
      <h2>Patientens personnummer eller samordningsnummer</h2>
      <FormWrapper className="iu-mt-300">
        <PersonIdInput onFormattedChange={onChange} value={patientId} />
        <CustomButton text="FortsÃ¤tt" disabled={!isPersonIdValid(patientId)} buttonStyle="primary" onClick={onSubmit} />
      </FormWrapper>
      <PatientSearchError />
    </div>
  )
}
export default PatientSearch
